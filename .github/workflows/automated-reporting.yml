name: Automated Agent Reporting System

on:
  schedule:
    # Curator hourly reports - every hour
    - cron: '0 * * * *'
    # Daily agent reports - every day at midnight UTC
    - cron: '0 0 * * *'
    # Weekly summary - every Monday at 00:00 UTC
    - cron: '0 0 * * 1'
  workflow_dispatch:
    inputs:
      report_type:
        description: 'Type of report to generate'
        required: true
        default: 'all'
        type: choice
        options:
          - hourly
          - daily
          - weekly
          - all

jobs:
  hourly-curator-report:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 * * * *' || github.event.inputs.report_type == 'hourly' || github.event.inputs.report_type == 'all'
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Generate Curator Hourly Report
        run: |
          echo "ğŸ“‹ Generating Curator Hourly Report"
          python3 agents/nexus-controller/reporting.py hourly
      
      - name: Commit reports
        run: |
          git config user.name "Echo Curator Bot"
          git config user.email "curator@echo.universe"
          git add agents/reports/
          git add ledgers/automation/coordination_log.jsonl
          git diff --quiet && git diff --staged --quiet || \
            git commit -m "ğŸ“‹ Curator hourly report - $(date -u +%Y-%m-%dT%H:00:00Z)" && \
            git push
  
  daily-agent-reports:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 0 * * *' || github.event.inputs.report_type == 'daily' || github.event.inputs.report_type == 'all'
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Generate Daily Agent Reports
        run: |
          echo "ğŸ“Š Generating Daily Agent Reports"
          python3 agents/nexus-controller/reporting.py daily
      
      - name: Commit reports
        run: |
          git config user.name "Echo Agent Reporter"
          git config user.email "agents@echo.universe"
          git add agents/reports/
          git add ledgers/automation/coordination_log.jsonl
          git diff --quiet && git diff --staged --quiet || \
            git commit -m "ğŸ“Š Daily agent reports - $(date -u +%Y-%m-%d)" && \
            git push
  
  weekly-summary:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 0 * * 1' || github.event.inputs.report_type == 'weekly' || github.event.inputs.report_type == 'all'
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Generate Weekly Summary
        run: |
          echo "ğŸ“ˆ Generating Weekly Summary"
          python3 agents/nexus-controller/reporting.py weekly
      
      - name: Commit reports
        run: |
          git config user.name "Echo Summary Bot"
          git config user.email "summary@echo.universe"
          git add agents/reports/
          git add ledgers/automation/coordination_log.jsonl
          git diff --quiet && git diff --staged --quiet || \
            git commit -m "ğŸ“ˆ Weekly summary - Week of $(date -u +%Y-%m-%d)" && \
            git push
  
  verify-ledger:
    runs-on: ubuntu-latest
    needs: [hourly-curator-report, daily-agent-reports, weekly-summary]
    if: always()
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Verify Constitutional Ledger Integrity
        run: |
          echo "ğŸ” Verifying Constitutional Ledger"
          python3 ledgers/automation/ledger.py verify
      
      - name: Export Audit Report
        if: always()
        run: |
          python3 ledgers/automation/ledger.py export agents/reports/ledger_audit_$(date +%Y%m%d).txt
      
      - name: Commit audit
        if: always()
        run: |
          git config user.name "Echo Auditor Bot"
          git config user.email "auditor@echo.universe"
          git add agents/reports/ledger_audit_*.txt || true
          git diff --quiet && git diff --staged --quiet || \
            git commit -m "ğŸ” Ledger audit - $(date -u +%Y-%m-%dT%H:%M:%SZ)" && \
            git push
