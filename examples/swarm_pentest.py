#!/usr/bin/env python3
"""
Swarm Penetration Testing Example
=================================

Demonstrates creating and using an agent swarm for
coordinated penetration testing operations.

WARNING: Only use for authorized security testing!
"""

import asyncio
import sys
import os

sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from hydra.core.orchestrator import HydraOrchestrator
from hydra.config import HydraConfig
from hydra.tentacles.ai_models import ClaudeTentacle, GeminiTentacle
from hydra.tentacles.security import ReconTentacle, VulnScanTentacle, ExploitTentacle
from hydra.swarm.factory import SwarmFactory


async def main():
    """Penetration testing swarm demonstration"""
    print("=" * 60)
    print("üêù HYDRA SWARM - Penetration Testing Demo")
    print("=" * 60)
    print("\n‚ö†Ô∏è  This is for AUTHORIZED security testing only!\n")

    # Setup
    config = HydraConfig()
    orchestrator = HydraOrchestrator(config)

    # Add tentacles
    tentacles = [
        ClaudeTentacle("claude_primary"),
        GeminiTentacle("gemini_primary"),
        ReconTentacle("recon"),
        VulnScanTentacle("vulnscan"),
        ExploitTentacle("exploit"),
    ]

    for t in tentacles:
        await orchestrator.add_tentacle(t.tentacle_id, t)

    # Create swarm factory
    factory = SwarmFactory(orchestrator)
    orchestrator.swarm_factory = factory

    await orchestrator.start()

    # Create pentest swarm
    print("Creating penetration testing swarm...")
    swarm_id = await factory.create_swarm(template_name="pentest")

    status = factory.get_swarm_status(swarm_id)
    print(f"\nüìä Swarm Created: {swarm_id[:8]}...")
    print(f"   State: {status['state']}")
    print(f"   Agents: {status['agent_count']}")
    print("\n   Agent roster:")
    for agent in status['agents']:
        print(f"   - {agent['name']} ({agent['role']})")

    # Define the mission
    mission = {
        "description": "Authorized penetration test of test environment",
        "target": "testphp.vulnweb.com",  # Public vulnerable test site
        "scope": ["reconnaissance", "vulnerability_assessment"],
        "authorized": True,
        "timeout": 60
    }

    print(f"\nüéØ Mission: {mission['description']}")
    print(f"   Target: {mission['target']}")
    print(f"   Scope: {', '.join(mission['scope'])}")

    # Execute mission
    print("\nüöÄ Executing mission...\n")

    result = await factory.execute_mission(swarm_id, mission)

    # Display results
    print("üìã Mission Results:")
    print("-" * 40)
    for agent_result in result.get('results', []):
        print(f"   {agent_result['agent']}: {agent_result['tasks_completed']} tasks completed")

    # Dissolve swarm
    print("\nüßπ Dissolving swarm...")
    await factory.dissolve_swarm(swarm_id)

    # Cleanup
    await orchestrator.stop()

    print("\n" + "=" * 60)
    print("Penetration testing swarm demo complete!")
    print("=" * 60 + "\n")


if __name__ == "__main__":
    asyncio.run(main())
